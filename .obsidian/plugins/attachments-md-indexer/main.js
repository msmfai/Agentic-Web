/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Z=Object.defineProperty;var Pe=Object.getOwnPropertyDescriptor;var Ne=Object.getOwnPropertyNames;var De=Object.prototype.hasOwnProperty;var Me=(e,n)=>{for(var t in n)Z(e,t,{get:n[t],enumerable:!0})},Le=(e,n,t,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of Ne(n))!De.call(e,s)&&s!==t&&Z(e,s,{get:()=>n[s],enumerable:!(i=Pe(n,s))||i.enumerable});return e};var $e=e=>Le(Z({},"__esModule",{value:!0}),e);var Et={};Me(Et,{default:()=>X});module.exports=$e(Et);var F=require("obsidian");function se(e){if(!e)return null;try{let n=e.trim();if(!n)return null;let t=JSON.parse(n);return!t||typeof t!="object"||t===null||!("nodes"in t)||!Array.isArray(t.nodes)?null:t}catch(n){return null}}function b(e,n,t){let i=[];return typeof e=="object"&&e!==null&&"nodes"in e&&Array.isArray(e.nodes)&&(i=e.nodes),i.filter(s=>s.type===n).map(s=>typeof s[t]=="string"?s[t]:"")}function Be(e){return e.split(".").pop()||""}function Q(e){let n=Be(e);return n==="md"||n===""}function O(e,n,t,i){function s(o,r){return o.replace("{element}",r)}return t.length===0?"":`# ${e}

`+t.map(o=>s(n,o)).join(i)+`

`}var ee="This index file enables Obsidian and its plugins to manage canvas files effectively. It ensures alias files for canvases appear in graphs and allows plugins compatible only with MD files to access these files.",oe=`[[{element}]]

`+ee,re="![Web Page]({element})",ae=`{element}
___`,ce="![[{element}]]",le="![[{element}|500]]",C="This index file enables Obsidian and its plugins to manage image files effectively. It ensures image files appear in graphs and allows plugins compatible only with MD files to access these files.",D="This index file enables Obsidian and its plugins to manage PDF files effectively. It ensures PDF files appear in graphs and allows plugins compatible only with MD files to access these files.";function ke(e){return O(e,oe,[e],`

`)}function Ge(e){return b(e,"text","text")}function Ke(e){return b(e,"file","file").filter(Q).map(n=>n.replace(/\.md$/,"").split("/").pop()||n)}function je(e){return b(e,"link","url").sort((n,t)=>n.localeCompare(t))}function Ue(e){return b(e,"file","file").filter(n=>!Q(n))}function He(e,n,t,i){let s=O("Cards",ae,e,`

`),o=O("Notes",ce,n,`

<br/>

`),r=O("Web Pages",re,t,`

<br/>

`),a=O("Medias",le,i,`

<br/>

`);return s+o+r+a}function de(e,n){let t=ke(n),i=se(e);if(i===null)return t;let s=i,o=Ge(s),r=Ke(s),a=je(s),c=Ue(s);return t+He(o,r,a,c)}var ue;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(ue||(ue={}));var fe;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(fe||(fe={}));var ge;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(ge||(ge={}));var pe=["user","model","function","system"],he;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(he||(he={}));var me;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(me||(me={}));var ve;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(ve||(ve={}));var Ee;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(Ee||(Ee={}));var x;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"})(x||(x={}));var ye;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(ye||(ye={}));var Ce;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(Ce||(Ce={}));var Ae;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(Ae||(Ae={}));var f=class extends Error{constructor(n){super(`[GoogleGenerativeAI Error]: ${n}`)}},A=class extends f{constructor(n,t){super(n),this.response=t}},L=class extends f{constructor(n,t,i,s){super(n),this.status=t,this.statusText=i,this.errorDetails=s}},v=class extends f{},$=class extends f{};var Ye="https://generativelanguage.googleapis.com",Je="v1beta",qe="0.23.0",Ve="genai-js",S;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(S||(S={}));var te=class{constructor(n,t,i,s,o){this.model=n,this.task=t,this.apiKey=i,this.stream=s,this.requestOptions=o}toString(){var n,t;let i=((n=this.requestOptions)===null||n===void 0?void 0:n.apiVersion)||Je,o=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||Ye}/${i}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}};function ze(e){let n=[];return e!=null&&e.apiClient&&n.push(e.apiClient),n.push(`${Ve}/${qe}`),n.join(" ")}async function We(e){var n;let t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",ze(e.requestOptions)),t.append("x-goog-api-key",e.apiKey);let i=(n=e.requestOptions)===null||n===void 0?void 0:n.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(s){throw new v(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${s.message}`)}for(let[s,o]of i.entries()){if(s==="x-goog-api-key")throw new v(`Cannot set reserved header name ${s}`);if(s==="x-goog-api-client")throw new v(`Header name ${s} can only be set using the apiClient field`);t.append(s,o)}}return t}async function Xe(e,n,t,i,s,o){let r=new te(e,n,t,i,o);return{url:r.toString(),fetchOptions:Object.assign(Object.assign({},tt(o)),{method:"POST",headers:await We(r),body:s})}}async function P(e,n,t,i,s,o={},r=fetch){let{url:a,fetchOptions:c}=await Xe(e,n,t,i,s,o);return Ze(a,c,r)}async function Ze(e,n,t=fetch){let i;try{i=await t(e,n)}catch(s){Qe(s,e)}return i.ok||await et(i,e),i}function Qe(e,n){let t=e;throw t.name==="AbortError"?(t=new $(`Request aborted when fetching ${n.toString()}: ${e.message}`),t.stack=e.stack):e instanceof L||e instanceof v||(t=new f(`Error fetching from ${n.toString()}: ${e.message}`),t.stack=e.stack),t}async function et(e,n){let t="",i;try{let s=await e.json();t=s.error.message,s.error.details&&(t+=` ${JSON.stringify(s.error.details)}`,i=s.error.details)}catch(s){}throw new L(`Error fetching from ${n.toString()}: [${e.status} ${e.statusText}] ${t}`,e.status,e.statusText,i)}function tt(e){let n={};if((e==null?void 0:e.signal)!==void 0||(e==null?void 0:e.timeout)>=0){let t=new AbortController;(e==null?void 0:e.timeout)>=0&&setTimeout(()=>t.abort(),e.timeout),e!=null&&e.signal&&e.signal.addEventListener("abort",()=>{t.abort()}),n.signal=t.signal}return n}function ie(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),M(e.candidates[0]))throw new A(`${w(e)}`,e);return nt(e)}else if(e.promptFeedback)throw new A(`Text not available. ${w(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),M(e.candidates[0]))throw new A(`${w(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),we(e)[0]}else if(e.promptFeedback)throw new A(`Function call not available. ${w(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),M(e.candidates[0]))throw new A(`${w(e)}`,e);return we(e)}else if(e.promptFeedback)throw new A(`Function call not available. ${w(e)}`,e)},e}function nt(e){var n,t,i,s;let o=[];if(!((t=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||t===void 0)&&t.parts)for(let r of(s=(i=e.candidates)===null||i===void 0?void 0:i[0].content)===null||s===void 0?void 0:s.parts)r.text&&o.push(r.text),r.executableCode&&o.push("\n```"+r.executableCode.language+`
`+r.executableCode.code+"\n```\n"),r.codeExecutionResult&&o.push("\n```\n"+r.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}function we(e){var n,t,i,s;let o=[];if(!((t=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||t===void 0)&&t.parts)for(let r of(s=(i=e.candidates)===null||i===void 0?void 0:i[0].content)===null||s===void 0?void 0:s.parts)r.functionCall&&o.push(r.functionCall);if(o.length>0)return o}var it=[x.RECITATION,x.SAFETY,x.LANGUAGE];function M(e){return!!e.finishReason&&it.includes(e.finishReason)}function w(e){var n,t,i;let s="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)s+="Response was blocked",!((n=e.promptFeedback)===null||n===void 0)&&n.blockReason&&(s+=` due to ${e.promptFeedback.blockReason}`),!((t=e.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(s+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((i=e.candidates)===null||i===void 0)&&i[0]){let o=e.candidates[0];M(o)&&(s+=`Candidate was blocked due to ${o.finishReason}`,o.finishMessage&&(s+=`: ${o.finishMessage}`))}return s}function T(e){return this instanceof T?(this.v=e,this):new T(e)}function st(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(e,n||[]),s,o=[];return s={},r("next"),r("throw"),r("return"),s[Symbol.asyncIterator]=function(){return this},s;function r(l){i[l]&&(s[l]=function(d){return new Promise(function(u,E){o.push([l,d,u,E])>1||a(l,d)})})}function a(l,d){try{c(i[l](d))}catch(u){p(o[0][3],u)}}function c(l){l.value instanceof T?Promise.resolve(l.value.v).then(g,m):p(o[0][2],l)}function g(l){a("next",l)}function m(l){a("throw",l)}function p(l,d){l(d),o.shift(),o.length&&a(o[0][0],o[0][1])}}var _e=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function ot(e){let n=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=ct(n),[i,s]=t.tee();return{stream:at(i),response:rt(s)}}async function rt(e){let n=[],t=e.getReader();for(;;){let{done:i,value:s}=await t.read();if(i)return ie(lt(n));n.push(s)}}function at(e){return st(this,arguments,function*(){let t=e.getReader();for(;;){let{value:i,done:s}=yield T(t.read());if(s)break;yield yield T(ie(i))}})}function ct(e){let n=e.getReader();return new ReadableStream({start(i){let s="";return o();function o(){return n.read().then(({value:r,done:a})=>{if(a){if(s.trim()){i.error(new f("Failed to parse stream"));return}i.close();return}s+=r;let c=s.match(_e),g;for(;c;){try{g=JSON.parse(c[1])}catch(m){i.error(new f(`Error parsing JSON response: "${c[1]}"`));return}i.enqueue(g),s=s.substring(c[0].length),c=s.match(_e)}return o()}).catch(r=>{let a=r;throw a.stack=r.stack,a.name==="AbortError"?a=new $("Request aborted when reading from the stream"):a=new f("Error reading from the stream"),a})}}})}function lt(e){let n=e[e.length-1],t={promptFeedback:n==null?void 0:n.promptFeedback};for(let i of e){if(i.candidates){let s=0;for(let o of i.candidates)if(t.candidates||(t.candidates=[]),t.candidates[s]||(t.candidates[s]={index:s}),t.candidates[s].citationMetadata=o.citationMetadata,t.candidates[s].groundingMetadata=o.groundingMetadata,t.candidates[s].finishReason=o.finishReason,t.candidates[s].finishMessage=o.finishMessage,t.candidates[s].safetyRatings=o.safetyRatings,o.content&&o.content.parts){t.candidates[s].content||(t.candidates[s].content={role:o.content.role||"user",parts:[]});let r={};for(let a of o.content.parts)a.text&&(r.text=a.text),a.functionCall&&(r.functionCall=a.functionCall),a.executableCode&&(r.executableCode=a.executableCode),a.codeExecutionResult&&(r.codeExecutionResult=a.codeExecutionResult),Object.keys(r).length===0&&(r.text=""),t.candidates[s].content.parts.push(r)}s++}i.usageMetadata&&(t.usageMetadata=i.usageMetadata)}return t}async function be(e,n,t,i){let s=await P(n,S.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(t),i);return ot(s)}async function xe(e,n,t,i){let o=await(await P(n,S.GENERATE_CONTENT,e,!1,JSON.stringify(t),i)).json();return{response:ie(o)}}function Te(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function R(e){let n=[];if(typeof e=="string")n=[{text:e}];else for(let t of e)typeof t=="string"?n.push({text:t}):n.push(t);return dt(n)}function dt(e){let n={role:"user",parts:[]},t={role:"function",parts:[]},i=!1,s=!1;for(let o of e)"functionResponse"in o?(t.parts.push(o),s=!0):(n.parts.push(o),i=!0);if(i&&s)throw new f("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!s)throw new f("No content is provided for sending chat message.");return i?n:t}function ut(e,n){var t;let i={model:n==null?void 0:n.model,generationConfig:n==null?void 0:n.generationConfig,safetySettings:n==null?void 0:n.safetySettings,tools:n==null?void 0:n.tools,toolConfig:n==null?void 0:n.toolConfig,systemInstruction:n==null?void 0:n.systemInstruction,cachedContent:(t=n==null?void 0:n.cachedContent)===null||t===void 0?void 0:t.name,contents:[]},s=e.generateContentRequest!=null;if(e.contents){if(s)throw new v("CountTokensRequest must have one of contents or generateContentRequest, not both.");i.contents=e.contents}else if(s)i=Object.assign(Object.assign({},i),e.generateContentRequest);else{let o=R(e);i.contents=[o]}return{generateContentRequest:i}}function Se(e){let n;return e.contents?n=e:n={contents:[R(e)]},e.systemInstruction&&(n.systemInstruction=Te(e.systemInstruction)),n}function ft(e){return typeof e=="string"||Array.isArray(e)?{content:R(e)}:e}var Ie=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],gt={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function pt(e){let n=!1;for(let t of e){let{role:i,parts:s}=t;if(!n&&i!=="user")throw new f(`First content should be with role 'user', got ${i}`);if(!pe.includes(i))throw new f(`Each item should include role field. Got ${i} but valid roles are: ${JSON.stringify(pe)}`);if(!Array.isArray(s))throw new f("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new f("Each Content should have at least one part");let o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let a of s)for(let c of Ie)c in a&&(o[c]+=1);let r=gt[i];for(let a of Ie)if(!r.includes(a)&&o[a]>0)throw new f(`Content with role '${i}' can't contain '${a}' part`);n=!0}}function Fe(e){var n;if(e.candidates===void 0||e.candidates.length===0)return!1;let t=(n=e.candidates[0])===null||n===void 0?void 0:n.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(let i of t.parts)if(i===void 0||Object.keys(i).length===0||i.text!==void 0&&i.text==="")return!1;return!0}var Oe="SILENT_ERROR",ne=class{constructor(n,t,i,s={}){this.model=t,this.params=i,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=n,i!=null&&i.history&&(pt(i.history),this._history=i.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(n,t={}){var i,s,o,r,a,c;await this._sendPromise;let g=R(n),m={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(r=this.params)===null||r===void 0?void 0:r.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,g]},p=Object.assign(Object.assign({},this._requestOptions),t),l;return this._sendPromise=this._sendPromise.then(()=>xe(this._apiKey,this.model,m,p)).then(d=>{var u;if(Fe(d.response)){this._history.push(g);let E=Object.assign({parts:[],role:"model"},(u=d.response.candidates)===null||u===void 0?void 0:u[0].content);this._history.push(E)}else{let E=w(d.response);E&&console.warn(`sendMessage() was unsuccessful. ${E}. Inspect response object for details.`)}l=d}),await this._sendPromise,l}async sendMessageStream(n,t={}){var i,s,o,r,a,c;await this._sendPromise;let g=R(n),m={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(r=this.params)===null||r===void 0?void 0:r.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,g]},p=Object.assign(Object.assign({},this._requestOptions),t),l=be(this._apiKey,this.model,m,p);return this._sendPromise=this._sendPromise.then(()=>l).catch(d=>{throw new Error(Oe)}).then(d=>d.response).then(d=>{if(Fe(d)){this._history.push(g);let u=Object.assign({},d.candidates[0].content);u.role||(u.role="model"),this._history.push(u)}else{let u=w(d);u&&console.warn(`sendMessageStream() was unsuccessful. ${u}. Inspect response object for details.`)}}).catch(d=>{d.message!==Oe&&console.error(d)}),l}};async function ht(e,n,t,i){return(await P(n,S.COUNT_TOKENS,e,!1,JSON.stringify(t),i)).json()}async function mt(e,n,t,i){return(await P(n,S.EMBED_CONTENT,e,!1,JSON.stringify(t),i)).json()}async function vt(e,n,t,i){let s=t.requests.map(r=>Object.assign(Object.assign({},r),{model:n}));return(await P(n,S.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:s}),i)).json()}var B=class{constructor(n,t,i={}){this.apiKey=n,this._requestOptions=i,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=Te(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(n,t={}){var i;let s=Se(n),o=Object.assign(Object.assign({},this._requestOptions),t);return xe(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},s),o)}async generateContentStream(n,t={}){var i;let s=Se(n),o=Object.assign(Object.assign({},this._requestOptions),t);return be(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},s),o)}startChat(n){var t;return new ne(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},n),this._requestOptions)}async countTokens(n,t={}){let i=ut(n,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),t);return ht(this.apiKey,this.model,i,s)}async embedContent(n,t={}){let i=ft(n),s=Object.assign(Object.assign({},this._requestOptions),t);return mt(this.apiKey,this.model,i,s)}async batchEmbedContents(n,t={}){let i=Object.assign(Object.assign({},this._requestOptions),t);return vt(this.apiKey,this.model,n,i)}};var k=class{constructor(n){this.apiKey=n}getGenerativeModel(n,t){if(!n.model)throw new f("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new B(this.apiKey,n,t)}getGenerativeModelFromCachedContent(n,t,i){if(!n.name)throw new v("Cached content must contain a `name` field.");if(!n.model)throw new v("Cached content must contain a `model` field.");let s=["model","systemInstruction"];for(let r of s)if(t!=null&&t[r]&&n[r]&&(t==null?void 0:t[r])!==n[r]){if(r==="model"){let a=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,c=n.model.startsWith("models/")?n.model.replace("models/",""):n.model;if(a===c)continue}throw new v(`Different value for "${r}" specified in modelParams (${t[r]}) and cachedContent (${n[r]})`)}let o=Object.assign(Object.assign({},t),{model:n.model,tools:n.tools,toolConfig:n.toolConfig,systemInstruction:n.systemInstruction,cachedContent:n});return new B(this.apiKey,o,i)}};var y=class extends Error{constructor(n){super(n),this.name="FatalProcessingError"}},I=class{constructor(n,t,i){this.config=n;this.mimeType=t;this.prompt=i;this.MAX_FILE_SIZE_MB=22;this.validateApiKey()}validateApiKey(){return!!this.config.getApiKey()}arrayBufferToBase64(n){let t=new Uint8Array(n),i="";return t.forEach(s=>i+=String.fromCharCode(s)),btoa(i)}validateFileSize(n,t){return n>this.MAX_FILE_SIZE_MB?`## File Too Large

This file exceeds the maximum size limit for Gemini AI processing.

**Details:**
- File size: ${n.toFixed(2)}MB
- Maximum allowed: ${this.MAX_FILE_SIZE_MB}MB
- File: ${t}

The file cannot be processed due to Gemini API limitations.`:null}async tryGenerateContent(n,t,i=0,s){var r,a,c,g,m;let o=this.validateFileSize(s,t);if(o)return o;try{let p=await n(),d=new k(this.config.getApiKey()).getGenerativeModel({model:"gemini-2.0-flash"}),E={inlineData:{data:this.arrayBufferToBase64(p),mimeType:this.mimeType}};return(((m=(g=(c=(a=(r=(await d.generateContent([this.prompt,E])).response.candidates)==null?void 0:r[0])==null?void 0:a.content)==null?void 0:c.parts)==null?void 0:g[0])==null?void 0:m.text)||"No content found").trim()}catch(p){if(p instanceof Error&&p.message.includes("400"))return console.warn(`\u26A0\uFE0F Processing Error
File: ${t}
Size: ${s}MB`),`## Processing Error

This file could not be processed by Gemini AI.

**Details:**
- File size: ${s}MB
- File type: ${this.mimeType}
- Error: ${p.message}

Please check the plugin documentation for troubleshooting steps.`;if(i<3)return console.warn(`Retry attempt ${i+1} for ${t}`),await new Promise(l=>setTimeout(l,1e3*(i+1))),this.tryGenerateContent(n,t,i+1,s);throw new y(`Failed to process file after 3 retries: ${t}`)}}async parseAttachmentContent(n,t,i){return this.tryGenerateContent(t,i,0,n)}};var h=class{constructor(n,t){this.fileDao=n;this.config=t}async convertFiles(){try{await this.fileDao.createFolder(this.config.indexFolder);let n=await this.fileDao.getFiles(),t=n.filter(a=>a.path.endsWith(this.config.sourceExtension)),i=n.filter(a=>a.path.startsWith(`${this.config.indexFolder}/`)&&a.path.endsWith(this.config.targetExtension)),[s,o,r]=await Promise.all([this.removeOrphanedFiles(i,t),this.createConvertedFiles(t,i),this.modifyConvertedFiles(t,i)]);this.logConversionResults(s,o,r,t.length)}catch(n){if(console.error("Error during conversion:",n),n instanceof y)throw n}}getSourceName(n){return n.name.slice(0,-this.config.targetExtension.length)+this.config.sourceExtension}getConvertedFilePath(n){return`${this.config.indexFolder}/${n.slice(0,-this.config.sourceExtension.length)}${this.config.targetExtension}`}async removeOrphanedFiles(n,t){let i=new Set(t.map(o=>o.name)),s=n.filter(o=>!i.has(this.getSourceName(o))).map(async o=>{try{return await this.fileDao.deleteFile(o.path),o.path}catch(r){return console.error(`Failed to remove converted file ${o.path}:`,r),null}});return(await Promise.all(s)).filter(Boolean)}async createConvertedFiles(n,t){let i=new Set(t.map(o=>this.getSourceName(o))),s=[];for(let o of n.filter(r=>!i.has(r.name)))try{let r=this.getConvertedFilePath(o.name);await this.convertAndSave(o,r),s.push(o.name)}catch(r){if(r instanceof y)throw r;console.error(`Error processing file ${o.name}:`,r)}return{count:s.length,files:s}}async modifyConvertedFiles(n,t){let i=new Map(t.map(o=>[this.getSourceName(o),o])),s=[];for(let o of n){let r=i.get(o.name);if(r&&o.modifiedTime>=r.modifiedTime)try{let a=this.getConvertedFilePath(o.name);await this.convertAndSave(o,a),s.push(o.name)}catch(a){if(a instanceof y)throw a;console.error(`Error processing file ${o.name}:`,a)}}return{count:s.length,files:s}}async convertAndSave(n,t){let i=await this.convertContent(n);await this.fileDao.createOrUpdateFile(t,i)}logConversionResults(n,t,i,s){console.log(`File conversion completed successfully
Total files processed ${t.count+i.count+n.length}/${s}
Created files ${t.count}
`+(t.count>0?`  ${t.files.map(o=>`- ${o.replace(this.config.sourceExtension,"")}`).join(`
  `)}
`:"")+`Modified files ${i.count}
`+(i.count>0?`  ${i.files.map(o=>`- ${o.replace(this.config.sourceExtension,"")}`).join(`
  `)}
`:"")+`Deleted files ${n.length}
`+(n.length>0?`  ${n.map(o=>`- ${o.replace(`${this.config.indexFolder}/`,"").replace(this.config.targetExtension,"")}`).join(`
  `)}
`:""))}};var G=class extends h{constructor(n,t){super(n,{indexFolder:t.indexFolder,sourceExtension:".canvas",targetExtension:t.canvasPostfix})}async convertContent(n){let t=await n.getContent();return de(t,n.name)}};var K=class{constructor(n,t,i,s,o,r){this.path=n;this.name=t;this.modifiedTime=i;this.sizeInBytes=s;this.contentResolver=o;this.binaryContentResolver=r}get sizeInMB(){return this.sizeInBytes/(1024*1024)}async getContent(){return this.contentResolver()}async getBinaryContent(){return this.binaryContentResolver()}};var j=class{constructor(n){this.fileAdapter=n}async readFile(n){try{return await this.fileAdapter.read(n)}catch(t){return}}async deleteFile(n){let t=await this.readFile(n);if(t&&!t.includes(ee)&&!t.includes(C)&&!t.includes(D))throw new Error(`Cannot delete file at ${n} - it does not appear to be an index file`);await this.fileAdapter.delete(n)}async createOrUpdateFile(n,t){try{await this.fileAdapter.modify(n,t)}catch(i){try{await this.fileAdapter.create(n,t)}catch(s){throw console.error(`Error in createOrUpdateFile for path ${n}:`,s),s}}}async getFiles(){return(await this.fileAdapter.getFiles()).map(t=>new K(t.path,t.name,t.modifiedTime,t.sizeInBytes,async()=>{let i=await this.fileAdapter.read(t.path);if(i===void 0)throw new Error(`File not found: ${t.path}`);return i},async()=>{let i=this.fileAdapter.readBinary(t.path);if(i===void 0)throw new Error(`File not found: ${t.path}`);return i}))}async createFolder(n){await this.fileAdapter.createFolder(n)}};var U=require("obsidian"),H=class{constructor(n){this.app=n}async getFiles(){return(await this.app.vault.getFiles()).map(t=>({path:t.path,name:t.name,modifiedTime:t.stat.mtime,sizeInBytes:t.stat.size}))}async createFolder(n){this.app.vault.getAbstractFileByPath(n)||await this.app.vault.createFolder(n)}async read(n){let t=this.app.vault.getAbstractFileByPath(n);if(!t||!(t instanceof U.TFile))throw new Error(`File not found: ${n}`);return this.app.vault.read(t)}async create(n,t){await this.app.vault.create(n,t)}async modify(n,t){let i=this.app.vault.getAbstractFileByPath(n);if(!i||!(i instanceof U.TFile))throw new Error(`File not found: ${n}`);await this.app.vault.modify(i,t)}async delete(n){let t=this.app.vault.getAbstractFileByPath(n);if(!t)throw new Error(`File not found: ${n}`);await this.app.fileManager.trashFile(t)}async readBinary(n){let t=this.app.vault.getAbstractFileByPath(n);if(!t||!(t instanceof U.TFile))throw new Error(`File not found: ${n}`);return this.app.vault.readBinary(t)}};var Y=class{constructor(n){this.plugin=n,this.settings=this.getDefaultSettings()}get canvasPostfix(){return".canvas.md"}get runOnStart(){return this.settings.runOnStart}get runOnStartMobile(){return this.settings.runOnStartMobile}get indexFolder(){return this.settings.indexFolder}get googleApiKey(){return this.settings.googleApiKey}getApiKey(){return this.settings.googleApiKey}async loadSettings(){this.settings=Object.assign(this.getDefaultSettings(),await this.plugin.loadData())}async updateRunOnStart(n){this.settings.runOnStart=n,await this.saveSettings()}async updateRunOnStartMobile(n){this.settings.runOnStartMobile=n,await this.saveSettings()}async updateIndexFolder(n){this.settings.indexFolder=n,await this.saveSettings()}async updateGoogleApiKey(n){this.settings.googleApiKey=n,await this.saveSettings()}async restoreDefaults(){this.settings=this.getDefaultSettings(),await this.saveSettings()}getDefaultSettings(){return{runOnStart:!0,runOnStartMobile:!1,indexFolder:"index",googleApiKey:""}}async saveSettings(){await this.plugin.saveData(this.settings)}};var _=require("obsidian"),J=class extends _.PluginSettingTab{constructor(n,t,i){super(n,t),this.settingsService=i}display(){let{containerEl:n}=this;n.empty();let t=n.createEl("div",{cls:"plugin-description"});t.createEl("h2",{text:"How This Plugin Works"});let i=t.createEl("p");i.innerHTML=`This plugin creates and synchronizes searchable markdown index files for various attachment types in your vault. It extracts and indexes complete text content, enabling both full-text and content-based search (e.g., finding images by words like "Flowers" or "Receipt"). Index files are automatically removed when originals are deleted:
		<ul>
			<li><strong>Canvas files</strong> (.canvas): Converts canvas JSON into markdown format with links to nodes and groups</li>
			<li><strong>PDF files</strong> (.pdf): Creates markdown files with PDF viewer and extracts complete text content for searching (requires Google API key)</li>
			<li><strong>Image files</strong> (.png, .jpg, .jpeg): Creates markdown files with embedded images and extracts all visible text for searching (requires Google API key)</li>
		</ul>
		All indexed files are stored in the specified index folder with their original extension plus ".md" (e.g., file.canvas \u2192 index/file.canvas.md). The plugin maintains synchronization, updating index files when originals change and removing them when originals are deleted.`,new _.Setting(n).setName("Run on start").setDesc("Automatically convert files when plugin loads").addToggle(s=>s.setValue(this.settingsService.runOnStart).onChange(async o=>{await this.settingsService.updateRunOnStart(o)})),new _.Setting(n).setName("Run on start (Mobile)").setDesc("Automatically convert files when plugin loads on mobile devices. Separate from desktop setting to help prevent crashes. It is recommended to enable this only after initial indexation is complete, as the process could take up to several days for large vaults and might cause Obsidian to restart if big files are present.").addToggle(s=>s.setValue(this.settingsService.runOnStartMobile).onChange(async o=>{await this.settingsService.updateRunOnStartMobile(o)})),new _.Setting(n).setName("Index folder").setDesc("Folder to store converted files (must be at least 3 chars). If you change this, you need to manually rename or delete the old folder and re-run the conversion.").addText(s=>s.setPlaceholder("index").setValue(this.settingsService.indexFolder).onChange(async o=>{o.length<3&&(o="index"),await this.settingsService.updateIndexFolder(o)})),new _.Setting(n).setName("Google API Key").setDesc(createFragment(s=>{s.appendText("Without this key, only Canvas files will be indexed. While Gemini has daily limits, they are usually sufficient for free usage. PDFs and images will be indexed gradually over several hours. Get your key here: "),s.createEl("a",{href:"https://aistudio.google.com/app/apikey",text:"https://aistudio.google.com/app/apikey",cls:"external-link"})})).addText(s=>{s.inputEl.type="password",s.setPlaceholder("Enter your Google API key").setValue(this.settingsService.googleApiKey).onChange(async o=>{await this.settingsService.updateGoogleApiKey(o)})}),new _.Setting(n).setName("Restore default settings").setDesc("Reset all settings to their default values").addButton(s=>s.setButtonText("Restore defaults").onClick(async()=>{await this.settingsService.restoreDefaults(),this.display()}))}};var q=class extends h{constructor(t,i,s){super(t,{indexFolder:i,sourceExtension:".png",targetExtension:".png.md"});this.parser=s}async convertContent(t){let i=await this.parser.parseAttachmentContent(t.sizeInMB,()=>t.getBinaryContent(),t.path);return`# ${t.name}

![[${t.name}|500]]

${C}

# Image Content

${i}
`}async convertFiles(){if(!this.parser.validateApiKey()){console.warn("No Google API key configured - image parsing will be skipped");return}await super.convertFiles()}};var V=class extends h{constructor(t,i,s){super(t,{indexFolder:i,sourceExtension:".jpg",targetExtension:".jpg.md"});this.parser=s}async convertContent(t){let i=await this.parser.parseAttachmentContent(t.sizeInMB,()=>t.getBinaryContent(),t.path);return`# ${t.name}

![[${t.name}|500]]

${C}

# Image Content

${i}
`}async convertFiles(){if(!this.parser.validateApiKey()){console.warn("No Google API key configured - image parsing will be skipped");return}await super.convertFiles()}};var z=class extends h{constructor(t,i,s){super(t,{indexFolder:i,sourceExtension:".jpeg",targetExtension:".jpeg.md"});this.parser=s}async convertContent(t){let i=await this.parser.parseAttachmentContent(t.sizeInMB,()=>t.getBinaryContent(),t.path);return`# ${t.name}

![[${t.name}|500]]

${C}

# Image Content

${i}
`}async convertFiles(){if(!this.parser.validateApiKey()){console.warn("No Google API key configured - image parsing will be skipped");return}await super.convertFiles()}};var W=class extends h{constructor(t,i,s){super(t,{indexFolder:i,sourceExtension:".pdf",targetExtension:".pdf.md"});this.parser=s}async convertContent(t){let i=await this.parser.parseAttachmentContent(t.sizeInMB,()=>t.getBinaryContent(),t.path);return`# ${t.name}

![[${t.name}#height=500]]

${D}

# PDF Content

${i}
`}async convertFiles(){if(!this.parser.validateApiKey()){console.warn("No Google API key configured - PDF parsing will be skipped");return}await super.convertFiles()}};var Re=require("obsidian"),X=class extends F.Plugin{constructor(){super(...arguments);this.isConverting=!1}async onload(){let t=new Y(this);await t.loadSettings();let i=new H(this.app),s=new j(i),o=new G(s,t),r=new I(t,"application/pdf","Extract and summarize the content of this PDF. Provide the complete text and a brief summary. If the PDF contains images, include descriptions of them and the full text they contain."),a=new I(t,"image/png","Extract and summarize the content of this image. Provide the complete text and a brief summary."),c=new I(t,"image/jpeg","Extract and summarize the content of this image. Provide the complete text and a brief summary."),g=new I(t,"image/jpeg","Extract and summarize the content of this image. Provide the complete text and a brief summary."),m=new W(s,t.indexFolder,r),p=new q(s,t.indexFolder,a),l=new V(s,t.indexFolder,c),d=new z(s,t.indexFolder,g),u=async()=>{if(this.isConverting){new F.Notice("Conversion is already in progress. Please wait.");return}this.isConverting=!0;try{await o.convertFiles(),await m.convertFiles(),await p.convertFiles(),await l.convertFiles(),await d.convertFiles(),new F.Notice("All attachments have been processed successfully")}catch(N){N instanceof y?(new F.Notice("Processing stopped due to Gemini API errors. Please try again later."),console.error("Conversion process stopped:",N.message)):(new F.Notice("An error occurred during processing"),console.error("Conversion error:",N))}finally{this.isConverting=!1}};this.addSettingTab(new J(this.app,this,t)),this.addCommand({id:"convert-canvas-files",name:"Convert attachment files to Markdown",callback:async()=>{await u()}}),(Re.Platform.isMobile?t.runOnStartMobile:t.runOnStart)&&this.app.workspace.onLayoutReady(()=>{u()})}onunload(){console.log("Obsidian Indexer plugin unloaded.")}};
/*! Bundled license information:

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/

/* nosourcemap */